{% extends "base.html" %}
{% block title %}โปรไฟล์ผู้ใช้ · COTTO Energy{% endblock %}
{% block content %}

<style>
  .profile-grid { display:grid; grid-template-columns: 1fr 320px; gap: 16px; }
  @media (max-width: 992px){ .profile-grid{ grid-template-columns: 1fr; } }
  .section-title { font-weight:700; }
  .help { color:#6c757d; font-size:.875rem; }
  .sticky-side { position: sticky; top: 88px; }
</style>

<h4 class="mb-3">โปรไฟล์ของฉัน</h4>

<div class="profile-grid">
  <!-- LEFT: FORM -->
  <div class="card shadow-sm">
    <div class="card-body">
      <div class="d-flex align-items-center justify-content-between mb-2">
        <div class="section-title">ข้อมูลส่วนตัว</div>
        <span class="help">อัปเดตข้อมูลของคุณเพื่อให้ผู้ดูแลติดต่อได้สะดวก</span>
      </div>

      <form method="post">
        <div class="row g-3">
          <div class="col-12 col-md-6">
            <label class="form-label">Plant</label>
            <input type="text" name="plant" class="form-control" value="{{ profile.plant or '' }}" placeholder="เช่น COTTO-01">
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label">Email</label>
            <input type="email" name="email" class="form-control" value="{{ profile.email or '' }}" placeholder="name@example.com">
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label">Firstname</label>
            <input type="text" name="firstname" class="form-control" value="{{ profile.firstname or '' }}" placeholder="ชื่อ">
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label">Lastname</label>
            <input type="text" name="lastname" class="form-control" value="{{ profile.lastname or '' }}" placeholder="นามสกุล">
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label">Position</label>
            <input type="text" name="position" class="form-control" value="{{ profile.position or '' }}" placeholder="ตำแหน่งงาน">
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label">Section</label>
            <input type="text" name="section" class="form-control" value="{{ profile.section or '' }}" placeholder="แผนก">
          </div>

          <div class="col-12">
            <label class="form-label">ตั้งรหัสผ่านใหม่ (ถ้าต้องการ)</label>
            <div class="input-group">
              <input id="newpw" type="password" name="new_password" class="form-control" placeholder="ปล่อยว่างถ้าไม่เปลี่ยน">
              <button class="btn btn-outline-secondary" type="button" id="toggleNewPw">แสดง</button>
            </div>
            <div class="help mt-1">อย่างน้อย 8 ตัวอักษร แนะนำให้มีทั้งตัวเลขและอักขระพิเศษ</div>
          </div>
        </div>

        <div class="d-flex justify-content-end mt-3">
          <button class="btn btn-primary" type="submit">บันทึกโปรไฟล์</button>
        </div>
      </form>
    </div>
  </div>

  <!-- RIGHT: SYSTEM INFO -->
  <div class="card shadow-sm sticky-side">
    <div class="card-body">
      <div class="section-title mb-3">ข้อมูลระบบ</div>

      <div class="mb-2"><span class="text-muted">User ID:</span> {{ profile.id }}</div>
      <div class="mb-2"><span class="text-muted">Username:</span> {{ profile.username }}</div>
      <div class="mb-2"><span class="text-muted">Role:</span> {{ profile.role }}</div>
      <div class="mb-2"><span class="text-muted">สร้างเมื่อ:</span>
        <span class="text-body">{{ profile.created_at }}</span>
      </div>

      <hr>
      <div class="help">
        หากเปลี่ยนรหัสผ่านสำเร็จ ระบบจะมีผลทันทีในการเข้าสู่ระบบครั้งถัดไป
      </div>
    </div>
  </div>
</div>

{% block scripts %}
<script>
  const t1 = document.getElementById('toggleNewPw');
  if (t1) {
    t1.addEventListener('click', () => {
      const i = document.getElementById('newpw');
      i.type = i.type === 'password' ? 'text' : 'password';
      t1.textContent = i.type === 'password' ? 'แสดง' : 'ซ่อน';
    });
  }
</script>
{% endblock %}
{% endblock %}
